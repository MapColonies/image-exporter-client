name: CI

on: [pull_request]

jobs:

  build_and_test:
    runs-on: ubuntu-latest

    steps:
      - name: checkout 
        uses: actions/checkout@v2
        
      - name: Install yarn
        run: |
          curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | sudo apt-key add -
          echo "deb https://dl.yarnpkg.com/debian/ stable main" | sudo tee /etc/apt/sources.list.d/yarn.list
          sudo apt-get update
          sudo apt-get install --no-install-recommends yarn
          
      - name: Install dependecies
        run: yarn
      - name: Lint
        run: yarn run eslint:check
      - name: Test
        run: yarn test
      - name: Build and push
        id: docker_build
        uses: docker/build-push-action@v2
        with:
          context: ./
          file: ./Dockerfile
          push: false
          tags: exporter-worker:latest
      #- name: Image digest
      #  run: echo ${{ steps.docker_build.outputs.digest }}
        
